<!doctype html>
<html data-theme="dark" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Cone Light MK.II System</title>

    <style>
      * {
        padding: 0px;
        margin: 0px;
        box-sizing: border-box;
      }
      html {
        width: 100%;
        height: 100%;
      }
      body {
        width: 100%;
        min-height: 100%;
        background: #63452c;
        font-family:
          system-ui, NotoSans, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell,
          Helvetica, Arial, "Helvetica Neue", sans-serif;
        color: #eee;
        display: flex;
        flex-direction: row;
        justify-content: center;
      }
      dialog:modal {
        min-width: 100%;
        min-height: 100%;
        background-color: #000d;
        border: none;
        padding: 1rem;
        display: flex;
        flex-direction: row;
        justify-content: center;
        align-items: center;
      }
      dialog .card {
        background-color: #63452c;
        color: #eee;
        max-width: 540px;
      }
      dialog .card .column {
        justify-content: center;
        max-width: 540px;
        align-items: center;
      }
      dialog img {
        max-width: 128px;
      }
      dialog progress {
        width: 100%;
      }
      hr {
        margin-top: 1rem;
        border: none;
        height: 1rem;
        background: #0001;
        border-radius: 10pt;
      }
      details summary {
        cursor: pointer;
      }
      .container {
        width: 100%;
        max-width: 540pt;
        margin: 1rem;
      }
      .card {
        display: flex;
        flex-direction: column;
        background: #986a44;
        border-radius: 10pt;
        padding: 0.5rem;
        margin-top: 1rem;
      }
      .card .row {
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
      }
      .card .column {
        display: flex;
        flex-direction: column;
      }
      .card .item {
        color: #210;
        display: flex;
        flex-direction: column;
        background: #cdab8f;
        flex-grow: 1;
        border-radius: 10pt;
        padding: 0.5rem;
        margin: 0.5rem;
      }
      .card .action {
        width: 100%;
      }
      .card .node {
        color: #210;
        display: flex;
        flex-direction: column;
        aspect-ratio: 1/1;
        text-align: center;
        background: #cdab8f;
        border-radius: 10pt;
        padding: 0.5rem;
        margin: 0.5rem;
      }
      .card .node img {
        width: 100%;
        flex-grow: 1;
      }
      .card .node meter {
        width: 100%;
      }
      @media screen and (width < 540px) {
        .card .node {
          /* CSS doesn't support calculating width as a simple percentage when we have a margin... */
          min-width: calc(50% - 1rem);
        }
      }
      @media screen and (width >= 540px) {
        .card .node {
          /* CSS doesn't support calculating width as a simple percentage when we have a margin... */
          max-width: calc(50% - 1rem);
        }
      }
      .card details summary {
        font-size: 1rem;
        font-weight: bold;
      }
      .card ::marker {
        color: #cdab8f;
        text-shadow: none;
      }
    </style>
    <script>
      class ConeLightRemote {
        constructor() {
          this.VERSION = "0.1.0";

          this.TX_POWER = -21.0;
          this.PATH_LOSS = 3.25;
          this.CONE_LIGHT_MIN_VOLTAGE = 4.6;
          this.CONE_LIGHT_MAX_VOLTAGE = 5.6;
          this.CONE_LIGHT_VOLTAGE_LOW = 4.8;
          this.CONE_LIGHT_VOLTAGE_MED = 5.1;
          this.CONE_LIGHT_VOLTAGE_HIGH = 5.3;

          // midi piano note labels
          this.MIDI_NOTES = [
            "",
            "",
            "",
            "",
            "",
            "",
            "",
            "",
            "",
            "",
            "",
            "",
            "",
            "",
            "",
            "",
            "",
            "",
            "",
            "",
            "",
            "A0",
            "A#0",
            "B0",
            "C1",
            "C#1",
            "D1",
            "D#1",
            "E1",
            "F1",
            "F#1",
            "G1",
            "G#1",
            "A1",
            "A#1",
            "B1",
            "C2",
            "C#2",
            "D2",
            "D#2",
            "E2",
            "F2",
            "F#2",
            "G2",
            "G#2",
            "A2",
            "A#2",
            "B2",
            "C3",
            "C#3",
            "D3",
            "D#3",
            "E3",
            "F3",
            "F#3",
            "G3",
            "G#3",
            "A3",
            "A#3",
            "B3",
            "C4|MIDDLE C",
            "C#4",
            "D4",
            "D#4",
            "E4",
            "F4",
            "F#4",
            "G4",
            "G#4",
            "A4",
            "A#4",
            "B4",
            "C5",
            "C#5",
            "D5",
            "D#5",
            "E5",
            "F5",
            "F#5",
            "G5",
            "G#5",
            "A5",
            "A#5",
            "B5",
            "C6",
            "C#6",
            "D6",
            "D#6",
            "E6",
            "F6",
            "F#6",
            "G6",
            "G#6",
            "A6",
            "A#6",
            "B6",
            "C7",
            "C#7",
            "D7",
            "D#7",
            "E7",
            "F7",
            "F#7",
            "G7",
            "G#7",
            "A7",
            "A#7",
            "B7",
            "C8",
            "",
            "",
            "",
            "",
            "",
            "",
            "",
            "",
            "",
            "",
            "",
            "",
            "",
            "",
            "",
            "",
            "",
            "",
            "",
          ];

          this.CONE_LIGHT_EMBED_LOGO = document.querySelector(
            "#embed_cone_light_logo",
          ).dataset.blob;
          this.CONE_LIGHT_EMBED_ICON = document.querySelector(
            "#embed_cone_light_icon",
          ).dataset.blob;

          this.DIALOG = document.querySelector("#dialog");

          this.NODES = [];
          this.GROUPS = [];
          this.TONES = [];
          this.SONGS = [];

          this.websocket = null;

          this.initialize();
        }

        initialize() {
          document.querySelectorAll(".cone_light_logo").forEach((item) => {
            item.src = this.CONE_LIGHT_EMBED_LOGO;
          });
          document.querySelectorAll(".cone_light_icon").forEach((item) => {
            item.src = this.CONE_LIGHT_EMBED_ICON;
          });

          document
            .querySelector("#led_control_brightness")
            .addEventListener("input", (event) => {
              document.querySelector(
                "#led_control_brightness_label",
              ).innerHTML = `${event.target.value}`;
            });
          document
            .querySelector("#tone_control_select_duration")
            .addEventListener("input", (event) => {
              document.querySelector("#tone_control_duration_label").innerHTML =
                `${event.target.value}ms`;
            });
          document
            .querySelector("#led_control_submit")
            .addEventListener("click", (event) => {
              if (
                this.websocket &&
                this.websocket.readyState == WebSocket.OPEN
              ) {
                this.handle_led_request();
              }
            });
          document
            .querySelector("#tone_control_submit")
            .addEventListener("click", (event) => {
              if (
                this.websocket &&
                this.websocket.readyState == WebSocket.OPEN
              ) {
                this.handle_tone_request();
              }
            });
          document
            .querySelector("#song_control_submit")
            .addEventListener("click", (event) => {
              if (
                this.websocket &&
                this.websocket.readyState == WebSocket.OPEN
              ) {
                this.handle_song_request();
              }
            });

          this.connect_websocket();

          console.log(
            "Cone Light Remote v%s initialization completed.",
            this.VERSION,
          );
        }

        connect_websocket() {
          this.DIALOG.showModal();

          this.websocket = new WebSocket(
            `ws://${window.location.host || "192.168.4.1"}/ws`,
          );
          this.websocket.addEventListener("open", (event) => {
            this.DIALOG.close();
            // nuke existing node data
            document.querySelector("#node_groups").innerHTML = "";

            if (this.interval_id) clearInterval(this.interval_id);

            this.interval_id = setInterval(() => {
              this.update();
            }, 1_000);
          });
          this.websocket.addEventListener("close", (event) => {
            this.DIALOG.showModal();
            // reconnect!
            this.connect_websocket();
          });
          this.websocket.addEventListener("message", (event) => {
            this.DIALOG.close();
            let payload = JSON.parse(event.data);
            // console.log(payload);

            switch (payload.data.type) {
              case "metadata":
                this.handle_metadata(payload);
                break;
              case "payload":
                this.handle_payload(payload);
                break;
            }
          });
        }

        update() {
          if (this.websocket && this.websocket.readyState == WebSocket.OPEN) {
            let data = {};
            data.data = {};
            data.data.command = "payload";

            this.websocket.send(JSON.stringify(data));
          }
        }

        handle_metadata(payload) {
          document.querySelector("#remote_node_version").innerHTML =
            `v${payload.data.metadata.firmware_version} p${payload.data.metadata.protocol_version}`;

          let index = 0;
          for (const group of payload.data.metadata.groups) {
            this.add_node_group(index, group);
            index++;
          }

          this.GROUPS = payload.data.metadata.groups;
          this.TONES = payload.data.metadata.tones;
          this.SONGS = payload.data.metadata.songs;

          this.populate_select_tone();
          this.populate_select_song();
        }

        handle_payload(payload) {
          document.querySelector("#remote_node_name").innerHTML =
            `${payload.data.remote.name}:${payload.data.remote.id}:${payload.data.remote.group_id}`;
          document.querySelector("#remote_node_voltage").value =
            payload.data.remote.voltage;
          document.querySelector("#remote_node_voltage").title =
            `${payload.data.remote.voltage.toFixed(3)}v`;
          this.configure_battery_meter(
            document.querySelector("#remote_node_voltage"),
          );

          if (!payload.data.nodes) return;

          let changed_node = false;
          for (const node of payload.data.nodes) {
            if (node.id == 255) continue;

            const node_div = document.querySelector(
              `[data-node_id="${node.id}"]`,
            );

            if (node_div) {
              this.update_node(node);
            } else {
              changed_node = true;
              this.add_node(node);
            }
          }

          if (changed_node) this.populate_select_node();
        }

        handle_led_request() {
          const color = document.querySelector("#led_control_color");
          const brightness = document.querySelector("#led_control_brightness");
          const select_node = document.querySelector(
            "#tone_control_select_node",
          );

          let data = {};
          data.data = {};
          data.data.command = "color"; // "brightness"
          data.data.parameters = [color.value, parseInt(brightness.value)];

          this.websocket.send(JSON.stringify(data));

          console.log(data);
        }

        handle_tone_request() {
          const select_tone = document.querySelector(
            "#tone_control_select_tone",
          );
          const duration = document.querySelector(
            "#tone_control_select_duration",
          );
          const select_node = document.querySelector(
            "#tone_control_select_node",
          );

          let data = {};
          data.data = {};
          data.data.command = "tone";
          data.data.parameters = [
            parseInt(select_tone.selectedOptions[0].value),
            parseInt(duration.value),
          ];

          this.websocket.send(JSON.stringify(data));

          console.log(data);
        }

        handle_song_request() {
          const select_song = document.querySelector(
            "#song_control_select_song",
          );
          const select_node = document.querySelector(
            "#song_control_select_node",
          );

          let data = {};
          data.data = {};
          data.data.command = "song";
          data.data.parameters = [
            parseInt(select_song.selectedOptions[0].value),
          ];

          this.websocket.send(JSON.stringify(data));

          console.log(data);
        }

        add_node_group(group_id, group_name) {
          const node_groups_div = document.querySelector("#node_groups");

          // .card <div>
          const card_div = document.createElement("div");
          card_div.className = "card";
          card_div.dataset.group_id = group_id;
          // title <b>
          const title_b = document.createElement("b");
          title_b.innerHTML = `${group_id}:${group_name} Group`;
          // .row <div>
          const row_div = document.createElement("div");
          row_div.className = "row";

          card_div.appendChild(title_b);
          card_div.appendChild(row_div);

          node_groups_div.appendChild(card_div);
        }

        add_node(node) {
          this.NODES[node.id] = node;

          const node_group_div = document.querySelector(
            `[data-group_id="${node.group_id}"] .row`,
          );

          // .node <div>
          const node_div = document.createElement("div");
          node_div.className = "node";
          node_div.dataset.node_id = node.id;
          // name <b>
          const name_b = document.createElement("b");
          name_b.innerHTML = `${node.name}:${node.id}:${node.group_id}`;
          // distance <p>
          const distance_p = document.createElement("p");
          distance_p.innerHTML = `${this.distance_feet(this.distance_meters(node.rssi)).toFixed(2)}ft`;
          // icon <img>
          const icon_img = document.createElement("img");
          icon_img.src = this.CONE_LIGHT_EMBED_ICON;
          // voltage <meter>
          const voltage_meter = document.createElement("meter");
          this.configure_battery_meter(voltage_meter);
          voltage_meter.value = node.voltage;
          voltage_meter.title = `${node.voltage.toFixed(3)}v`;

          node_div.appendChild(name_b);
          node_div.appendChild(distance_p);
          node_div.appendChild(icon_img);
          node_div.appendChild(voltage_meter);

          node_group_div.appendChild(node_div);
        }

        update_node(node) {
          const distance_p = document.querySelector(
            `[data-node_id="${node.id}"] p`,
          );
          const voltage_meter = document.querySelector(
            `[data-node_id="${node.id}"] meter`,
          );

          if (distance_p)
            distance_p.innerHTML = `${this.distance_feet(this.distance_meters(node.rssi)).toFixed(2)}ft`;

          if (voltage_meter) {
            voltage_meter.value = node.voltage;
            voltage_meter.title = `${node.voltage.toFixed(3)}v`;
          }
        }

        remove_node(node) {
          const node_group_div = document.querySelector(
            `[data-group_id="${node.group_id}"]`,
          );
          const node_div = document.querySelector(
            `[data-node_id="${node.id}"]`,
          );

          if (node_group_div && node_div) node_group_div.removeChild(node_div);
        }

        populate_select_tone() {
          const select_tone = document.querySelector(
            "#tone_control_select_tone",
          );

          select_tone.innerHTML = "";
          let i = 0;
          for (const tone of this.TONES) {
            const option = document.createElement("option");
            option.value = `${i}`;
            option.text = `${i}. ${this.MIDI_NOTES[i]} ${tone}hz`;

            select_tone.add(option);

            i++;
          }

          if (select_tone.options.length >= 69) {
            select_tone.selectedIndex = 69;
          }
        }

        populate_select_song() {
          const select_song = document.querySelector(
            "#song_control_select_song",
          );

          select_song.innerHTML = "";
          let i = 0;
          for (const song of this.SONGS) {
            const option = document.createElement("option");
            option.value = `${i}`;
            option.text = `${i}. ${song}`;

            select_song.add(option);

            i++;
          }
        }

        populate_select_node() {
          const select_nodes = document.querySelectorAll(".select_node");

          for (const select of select_nodes) {
            select.innerHTML = "";

            // all nodes
            const option_all = document.createElement("option");
            option_all.value = "ALL";
            option_all.text = "ALL";

            select.add(option_all);

            // groups label
            const optgroup_group = document.createElement("optgroup");
            optgroup_group.label = "Node Group";
            select.add(optgroup_group);

            // groups
            let i = 0;
            for (const group of this.GROUPS) {
              const option_group = document.createElement("option");
              option_group.value = `G${i}`;
              option_group.text = `${i}:${group} Group`;

              optgroup_group.appendChild(option_group);

              i++;
            }

            // nodes label
            const optgroup_name = document.createElement("optgroup");
            optgroup_name.label = "Individual Node";
            select.add(optgroup_name);

            // nodes
            for (const node of this.NODES) {
              if (!node) continue;

              const option_node = document.createElement("option");
              option_node.value = `n${node.id}`;
              option_node.text = `${node.name}:${node.id}:${node.group_id} Node`;

              optgroup_name.appendChild(option_node);
            }
          }
        }

        configure_battery_meter(element) {
          element.min = this.CONE_LIGHT_MIN_VOLTAGE;
          element.max = this.CONE_LIGHT_MAX_VOLTAGE;

          element.low = this.CONE_LIGHT_VOLTAGE_LOW;
          element.high = this.CONE_LIGHT_VOLTAGE_MED;
          element.optimum = this.CONE_LIGHT_VOLTAGE_HIGH;
        }

        distance_meters(rssi) {
          let exp = (this.TX_POWER - rssi) / (10 * this.PATH_LOSS);

          return 10 ** exp;
        }

        distance_feet(meters) {
          return (meters * 39.37008) / 12.0;
        }
      }

      window.addEventListener("load", (event) => {
        console.log("Cone Light Remote starting up...");
        const remote = new ConeLightRemote();
      });
    </script>
  </head>
  <body>
    <div
      id="embed_cone_light_icon"
      data-blob="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgoKPHN2ZwogICB3aWR0aD0iMTI3Ljk5OTk5IgogICBoZWlnaHQ9IjUzLjk5OTk5NiIKICAgdmlld0JveD0iMCAwIDMzLjg2NjY2NCAxNC4yODc0OTkiCiAgIHZlcnNpb249IjEuMSIKICAgaWQ9InN2ZzEiCiAgIGlua3NjYXBlOnZlcnNpb249IjEuNC4zICgwZDE1Zjc1MDQyLCAyMDI1LTEyLTI1KSIKICAgc29kaXBvZGk6ZG9jbmFtZT0iY29uZV9saWdodF9tazJfaWNvbi5zdmciCiAgIHhtbG5zOmlua3NjYXBlPSJodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy9uYW1lc3BhY2VzL2lua3NjYXBlIgogICB4bWxuczpzb2RpcG9kaT0iaHR0cDovL3NvZGlwb2RpLnNvdXJjZWZvcmdlLm5ldC9EVEQvc29kaXBvZGktMC5kdGQiCiAgIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIgogICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgIHhtbG5zOnN2Zz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogIDxzb2RpcG9kaTpuYW1lZHZpZXcKICAgICBpZD0ibmFtZWR2aWV3MSIKICAgICBwYWdlY29sb3I9IiNmZmZmZmYiCiAgICAgYm9yZGVyY29sb3I9IiMwMDAwMDAiCiAgICAgYm9yZGVyb3BhY2l0eT0iMC4yNSIKICAgICBpbmtzY2FwZTpzaG93cGFnZXNoYWRvdz0iMiIKICAgICBpbmtzY2FwZTpwYWdlb3BhY2l0eT0iMC4wIgogICAgIGlua3NjYXBlOnBhZ2VjaGVja2VyYm9hcmQ9IjAiCiAgICAgaW5rc2NhcGU6ZGVza2NvbG9yPSIjZDFkMWQxIgogICAgIGlua3NjYXBlOmRvY3VtZW50LXVuaXRzPSJweCIKICAgICBzaG93Z3JpZD0iZmFsc2UiCiAgICAgaW5rc2NhcGU6em9vbT0iOCIKICAgICBpbmtzY2FwZTpjeD0iNDkiCiAgICAgaW5rc2NhcGU6Y3k9IjkuODc1IgogICAgIGlua3NjYXBlOndpbmRvdy13aWR0aD0iMjU2MCIKICAgICBpbmtzY2FwZTp3aW5kb3ctaGVpZ2h0PSIxMzcxIgogICAgIGlua3NjYXBlOndpbmRvdy14PSIwIgogICAgIGlua3NjYXBlOndpbmRvdy15PSIwIgogICAgIGlua3NjYXBlOndpbmRvdy1tYXhpbWl6ZWQ9IjEiCiAgICAgaW5rc2NhcGU6Y3VycmVudC1sYXllcj0ibGF5ZXIxIj4KICAgIDxpbmtzY2FwZTpncmlkCiAgICAgICBpZD0iZ3JpZDEiCiAgICAgICB1bml0cz0icHgiCiAgICAgICBvcmlnaW54PSIwIgogICAgICAgb3JpZ2lueT0iLTkuNTI0OTk5OCIKICAgICAgIHNwYWNpbmd4PSIwLjI2NDU4MzMzIgogICAgICAgc3BhY2luZ3k9IjAuMjY0NTgzMzMiCiAgICAgICBlbXBjb2xvcj0iIzAwOTllNSIKICAgICAgIGVtcG9wYWNpdHk9IjAuMzAxOTYwNzgiCiAgICAgICBjb2xvcj0iIzAwOTllNSIKICAgICAgIG9wYWNpdHk9IjAuMTQ5MDE5NjEiCiAgICAgICBlbXBzcGFjaW5nPSI2IgogICAgICAgZW5hYmxlZD0idHJ1ZSIKICAgICAgIHZpc2libGU9ImZhbHNlIiAvPgogIDwvc29kaXBvZGk6bmFtZWR2aWV3PgogIDxkZWZzCiAgICAgaWQ9ImRlZnMxIj4KICAgIDxsaW5lYXJHcmFkaWVudAogICAgICAgaWQ9ImxpbmVhckdyYWRpZW50MSIKICAgICAgIGlua3NjYXBlOmNvbGxlY3Q9ImFsd2F5cyI+CiAgICAgIDxzdG9wCiAgICAgICAgIHN0eWxlPSJzdG9wLWNvbG9yOiNmZmZmZmY7c3RvcC1vcGFjaXR5OjEiCiAgICAgICAgIG9mZnNldD0iMCIKICAgICAgICAgaWQ9InN0b3AxIiAvPgogICAgICA8c3RvcAogICAgICAgICBzdHlsZT0ic3RvcC1jb2xvcjojOWE5OTk2O3N0b3Atb3BhY2l0eToxIgogICAgICAgICBvZmZzZXQ9IjEiCiAgICAgICAgIGlkPSJzdG9wMiIgLz4KICAgIDwvbGluZWFyR3JhZGllbnQ+CiAgICA8bGluZWFyR3JhZGllbnQKICAgICAgIGlua3NjYXBlOmNvbGxlY3Q9ImFsd2F5cyIKICAgICAgIHhsaW5rOmhyZWY9IiNsaW5lYXJHcmFkaWVudDEiCiAgICAgICBpZD0ibGluZWFyR3JhZGllbnQyIgogICAgICAgeDE9IjE5LjA0OTk5OSIKICAgICAgIHkxPSIxMC4xMzMwMzgiCiAgICAgICB4Mj0iMTkuMDQ5OTk5IgogICAgICAgeTI9IjIzLjgxMjQ5OCIKICAgICAgIGdyYWRpZW50VW5pdHM9InVzZXJTcGFjZU9uVXNlIiAvPgogIDwvZGVmcz4KICA8ZwogICAgIGlua3NjYXBlOmxhYmVsPSJMYXllciAxIgogICAgIGlua3NjYXBlOmdyb3VwbW9kZT0ibGF5ZXIiCiAgICAgaWQ9ImxheWVyMSIKICAgICB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwLC05LjUyNDk5OTYpIj4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDojZmZiZTZmO3N0cm9rZS13aWR0aDowLjUyOTE2NztzdHJva2UtbGluZWNhcDpzcXVhcmUiCiAgICAgICBkPSJtIDAuNTY0NDQ1MDIsMTkuOTMxOTQ0IHYgMi44MjIyMjMgSCAzMy4zMDIyMjEgdiAtMi44MjIyMjMgeiIKICAgICAgIGlkPSJwYXRoOS04IgogICAgICAgc29kaXBvZGk6bm9kZXR5cGVzPSJjY2NjYyIgLz4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDojZGVkZGRhO3N0cm9rZS13aWR0aDowLjUyOTE2NztzdHJva2UtbGluZWNhcDpzcXVhcmUiCiAgICAgICBkPSJNIDUuNjQ0NDQ0OCwxMC4wNTQxNjcgSCAyOC4yMjIyMjIgbCA1LjY0NDQ0NCw1LjY0NDQ0NCB2IDUuNjQ0NDQ1IEggNmUtNyB2IC01LjY0NDQ0NSB6IgogICAgICAgaWQ9InBhdGg4LTgiCiAgICAgICBzb2RpcG9kaTpub2RldHlwZXM9ImNjY2NjY2MiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6dXJsKCNsaW5lYXJHcmFkaWVudDIpO3N0cm9rZTpub25lO3N0cm9rZS13aWR0aDowO3N0cm9rZS1saW5lY2FwOnNxdWFyZTtzdHJva2UtZGFzaGFycmF5Om5vbmU7ZmlsbC1vcGFjaXR5OjEiCiAgICAgICBkPSJNIDZlLTcsMTUuNjk4NjExIDUuNjQ0NDQ0OCwxMC4wNTQxNjcgSCAyOC4yMjIyMjIgbCA1LjY0NDQ0NCw1LjY0NDQ0NCB6IgogICAgICAgaWQ9InBhdGgxMS00IiAvPgogIDwvZz4KPC9zdmc+Cg=="
    ></div>
    <div
      id="embed_cone_light_logo"
      data-blob="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYXRlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgoKPHN2ZwogICB3aWR0aD0iNTEwIgogICBoZWlnaHQ9IjUxMCIKICAgdmlld0JveD0iMCAwIDUxMCA1MTAiCiAgIHZlcnNpb249IjEuMSIKICAgaWQ9InN2ZzEiCiAgIGlua3NjYXBlOnZlcnNpb249IjEuNC4zICgwZDE1Zjc1MDQyLCAyMDI1LTEyLTI1KSIKICAgc29kaXBvZGk6ZG9jbmFtZT0iY29uZV9saWdodF9tazJfbG9nby5zdmciCiAgIHhtbG5zOmlua3NjYXBlPSJodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy9uYW1lc3BhY2VzL2lua3NjYXBlIgogICB4bWxuczpzb2RpcG9kaT0iaHR0cDovL3NvZGlwb2RpLnNvdXJjZWZvcmdlLm5ldC9EVEQvc29kaXBvZGktMC5kdGQiCiAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgeG1sbnM6c3ZnPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiAgPHNvZGlwb2RpOm5hbWVkdmlldwogICAgIGlkPSJuYW1lZHZpZXcxIgogICAgIHBhZ2Vjb2xvcj0iI2ZmZmZmZiIKICAgICBib3JkZXJjb2xvcj0iIzAwMDAwMCIKICAgICBib3JkZXJvcGFjaXR5PSIwLjI1IgogICAgIGlua3NjYXBlOnNob3dwYWdlc2hhZG93PSIyIgogICAgIGlua3NjYXBlOnBhZ2VvcGFjaXR5PSIwLjAiCiAgICAgaW5rc2NhcGU6cGFnZWNoZWNrZXJib2FyZD0iMCIKICAgICBpbmtzY2FwZTpkZXNrY29sb3I9IiNkMWQxZDEiCiAgICAgaW5rc2NhcGU6ZG9jdW1lbnQtdW5pdHM9InB4IgogICAgIHNob3dncmlkPSJ0cnVlIgogICAgIHNob3dndWlkZXM9ImZhbHNlIgogICAgIGlua3NjYXBlOnpvb209IjEuMTMwODU5NCIKICAgICBpbmtzY2FwZTpjeD0iMTI3LjMzNjc5IgogICAgIGlua3NjYXBlOmN5PSIyNjYuMTY5MjYiCiAgICAgaW5rc2NhcGU6d2luZG93LXdpZHRoPSIyNTYwIgogICAgIGlua3NjYXBlOndpbmRvdy1oZWlnaHQ9IjEzNzEiCiAgICAgaW5rc2NhcGU6d2luZG93LXg9IjAiCiAgICAgaW5rc2NhcGU6d2luZG93LXk9IjAiCiAgICAgaW5rc2NhcGU6d2luZG93LW1heGltaXplZD0iMSIKICAgICBpbmtzY2FwZTpjdXJyZW50LWxheWVyPSJsYXllcjEiPgogICAgPGlua3NjYXBlOmdyaWQKICAgICAgIGlkPSJncmlkMSIKICAgICAgIHVuaXRzPSJweCIKICAgICAgIG9yaWdpbng9IjAiCiAgICAgICBvcmlnaW55PSIwIgogICAgICAgc3BhY2luZ3g9IjEiCiAgICAgICBzcGFjaW5neT0iMSIKICAgICAgIGVtcGNvbG9yPSIjMDA5OWU1IgogICAgICAgZW1wb3BhY2l0eT0iMC4zMDE5NjA3OCIKICAgICAgIGNvbG9yPSIjMDA5OWU1IgogICAgICAgb3BhY2l0eT0iMC4xNDkwMTk2MSIKICAgICAgIGVtcHNwYWNpbmc9IjYiCiAgICAgICBlbmFibGVkPSJ0cnVlIgogICAgICAgdmlzaWJsZT0idHJ1ZSIgLz4KICAgIDxzb2RpcG9kaTpndWlkZQogICAgICAgcG9zaXRpb249IjEyLDQwMiIKICAgICAgIG9yaWVudGF0aW9uPSIxLDAiCiAgICAgICBpZD0iZ3VpZGUyIgogICAgICAgaW5rc2NhcGU6bG9ja2VkPSJmYWxzZSIgLz4KICAgIDxzb2RpcG9kaTpndWlkZQogICAgICAgcG9zaXRpb249IjEyLDQ5OCIKICAgICAgIG9yaWVudGF0aW9uPSIwLC0xIgogICAgICAgaWQ9Imd1aWRlMyIKICAgICAgIGlua3NjYXBlOmxvY2tlZD0iZmFsc2UiIC8+CiAgICA8c29kaXBvZGk6Z3VpZGUKICAgICAgIHBvc2l0aW9uPSI0OTgsNDk4IgogICAgICAgb3JpZW50YXRpb249IjEsMCIKICAgICAgIGlkPSJndWlkZTQiCiAgICAgICBpbmtzY2FwZTpsb2NrZWQ9ImZhbHNlIiAvPgogICAgPHNvZGlwb2RpOmd1aWRlCiAgICAgICBwb3NpdGlvbj0iMTIsMTIiCiAgICAgICBvcmllbnRhdGlvbj0iMCwtMSIKICAgICAgIGlkPSJndWlkZTUiCiAgICAgICBpbmtzY2FwZTpsb2NrZWQ9ImZhbHNlIiAvPgogIDwvc29kaXBvZGk6bmFtZWR2aWV3PgogIDxkZWZzCiAgICAgaWQ9ImRlZnMxIiAvPgogIDxnCiAgICAgaW5rc2NhcGU6bGFiZWw9IkxheWVyIDEiCiAgICAgaW5rc2NhcGU6Z3JvdXBtb2RlPSJsYXllciIKICAgICBpZD0ibGF5ZXIxIj4KICAgIDxyZWN0CiAgICAgICBzdHlsZT0iZmlsbDojYjU4MzVhO3N0cm9rZTpub25lO3N0cm9rZS1saW5lY2FwOnNxdWFyZSIKICAgICAgIGlkPSJyZWN0NSIKICAgICAgIHdpZHRoPSI1MTAiCiAgICAgICBoZWlnaHQ9IjUxMCIKICAgICAgIHg9IjAiCiAgICAgICB5PSIwIgogICAgICAgcnk9IjI0IiAvPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOiNmZmZmZmY7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjAuOTk5OTk0O3N0cm9rZS1saW5lY2FwOnNxdWFyZSIKICAgICAgIGQ9Ik0gNzgsNDMyIDE5Ni42OCw1MC44OCBIIDMxMy4zMiBMIDQzMiw0MzIgWiIKICAgICAgIGlkPSJwYXRoMSIKICAgICAgIHNvZGlwb2RpOm5vZGV0eXBlcz0iY2NjY2MiIC8+CiAgICA8cGF0aAogICAgICAgc3R5bGU9ImZpbGw6I2NkYWI4ZjtzdHJva2U6bm9uZTtzdHJva2Utd2lkdGg6MC45OTk5OTQ7c3Ryb2tlLWxpbmVjYXA6c3F1YXJlIgogICAgICAgZD0ibSAyNDYsMTI2IGggMTggdiA1MSBoIDYwIHYgMjAgSCAyNjQgViAzNzIgSCAyNDYgViAxOTcgaCAtNjAgdiAtMjAgaCA2MCB6IgogICAgICAgaWQ9InBhdGgyIgogICAgICAgc29kaXBvZGk6bm9kZXR5cGVzPSJjY2NjY2NjY2NjY2NjIiAvPgogICAgPHJlY3QKICAgICAgIHN0eWxlPSJmaWxsOiNmNmY1ZjQ7c3Ryb2tlOm5vbmU7c3Ryb2tlLXdpZHRoOjAuOTk5OTk0O3N0cm9rZS1saW5lY2FwOnNxdWFyZSIKICAgICAgIGlkPSJyZWN0MSIKICAgICAgIHdpZHRoPSI0ODYiCiAgICAgICBoZWlnaHQ9IjM4Ljg4MDAwMSIKICAgICAgIHg9IjEyIgogICAgICAgeT0iNDIwLjIzOTk5IgogICAgICAgcnk9IjAiIC8+CiAgPC9nPgo8L3N2Zz4K"
    ></div>
    <dialog id="dialog">
      <div class="card">
        <div class="column">
          <img class="cone_light_logo" />
          <h2>Cone Light MK.II System</h2>
          <p>Connecting...</p>
          <progress />
        </div>
      </div>
    </dialog>
    <div class="container">
      <h2 style="text-align: center">Cone Light MK.II System</h2>
      <!-- REMOTE HEADER -->
      <div class="card">
        <div
          class="row"
          style="justify-content: space-between; vertical-align: center"
        >
          <b id="remote_node_name">8:REMOTE</b>
          <p
            id="remote_node_version"
            style="margin: auto 0; font-family: monospace"
          >
            v2026.02.26 p4
          </p>
          <meter
            id="remote_node_voltage"
            min="4.200"
            max="5.600"
            value="5.241"
            title="5.241v"
          >
            5.241v
          </meter>
        </div>
      </div>

      <!-- NODE GROUPS -->
      <div id="node_groups"></div>

      <hr />

      <!-- LED CONTROL -->
      <div class="card">
        <details>
          <summary>LED Control</summary>
          <div class="row">
            <div class="item">
              <label>Choose color</label>
              <input id="led_control_color" type="color" value="#ffffff" />
            </div>
            <div class="item">
              <label for="led_control_brightness">Choose brightness</label>
              <input
                id="led_control_brightness"
                name="led_control_brightness"
                type="range"
                min="0"
                max="255"
                value="25"
              />
              <p id="led_control_brightness_label">25</p>
            </div>
            <div class="item">
              <label for="led_control_select_node">Choose node or group</label>
              <select
                id="led_control_select_node"
                name="led_control_select_node"
                class="select_node"
              ></select>
            </div>
            <div class="item action">
              <div class="row" style="justify-content: space-evenly">
                <label for="led_control_auto_update">
                  <input
                    id="led_control_auto_update"
                    name="led_control_auto_update"
                    type="checkbox"
                  />
                  Auto update?
                </label>
                <label for="led_control_brightness_only">
                  <input
                    id="led_control_brightness_only"
                    name="led_control_brightness_only"
                    type="checkbox"
                  />
                  Apply brightness only?
                </label>
              </div>
              <p>&nbsp;</p>
              <input id="led_control_submit" type="button" value="UPDATE" />
            </div>
          </div>
        </details>
      </div>

      <!-- TONE CONTROL -->
      <div class="card">
        <details>
          <summary>Tone Control</summary>
          <div class="row">
            <div class="item">
              <label for="tone_control_select_tone">Choose tone</label>
              <select
                id="tone_control_select_tone"
                name="tone_control_select_tone"
              ></select>
            </div>
            <div class="item">
              <label for="tone_control_select_duration">Choose duration</label>
              <input
                id="tone_control_select_duration"
                name="tone_control_select_duration"
                type="range"
                min="1"
                max="10000"
                value="1000"
              />
              <p id="tone_control_duration_label">1 000ms</p>
            </div>
            <div class="item">
              <label for="tone_control_select_node">Choose node or group</label>
              <select
                id="tone_control_select_node"
                name="tone_control_select_node"
                class="select_node"
              ></select>
            </div>
            <div class="item action">
              <input id="tone_control_submit" type="button" value="PLAY" />
            </div>
          </div>
        </details>
      </div>

      <!-- SONG CONTROL -->
      <div class="card">
        <details>
          <summary>Song Control</summary>
          <div class="row">
            <div class="item">
              <label>Choose song</label>
              <select id="song_control_select_song">
                <option>0. ABORT PLAYBACK</option>
                <optgroup label="Miscellaneous">
                  <option>1. Fur Elise</option>
                  <option>2. Happy Birthday</option>
                  <option>3. Pomp And Circumstance</option>
                  <option>4. Taps</option>
                </optgroup>
                <optgroup label="Christmas Carols">
                  <option>5. Away In A Manger</option>
                  <option>6. Carol Of The Bells</option>
                  <option>7. God Rest Ye Merry Gentlemen</option>
                  <option>8. Good Christian Men Rejoice</option>
                  <option>9. Hark The Harold Angels Sing</option>
                  <option>10. Joy To The World</option>
                  <option>11. O Come All Ye Faithful</option>
                  <option>12. O Little Town Of Bethlehem</option>
                  <option>13. Ode To Joy</option>
                  <option>14. Once In Royal Davids City</option>
                  <option>15. Silent Night</option>
                  <option>16. The First Noel</option>
                  <option>17. What Child Is This</option>
                </optgroup>
                <optgroup label="Hymns">
                  <option>18. A Mighty Fortress Is Our God</option>
                  <option>19. Abide With Me</option>
                  <option>20. All To Jesus I Surrender</option>
                  <option>21. Amazing Grace</option>
                  <option>22. At The Cross</option>
                  <option>23. Be Still My Soul</option>
                  <option>24. Be Thou My Vision</option>
                  <option>25. Blessed Assurance</option>
                  <option>26. Come Thou Fount Of Every Blessing</option>
                  <option>27. Day By Day</option>
                  <option>28. Doxology</option>
                  <option>29. Fairest Lord Jesus</option>
                  <option>30. Great Is Thy Faithfulness</option>
                  <option>31. His Eye Is On The Sparrow</option>
                  <option>32. Holy Holy Holy</option>
                  <option>33. How Great Thou Art</option>
                  <option>34. I Have Decided To Follow Jesus</option>
                  <option>35. I Need Thee Every Hour</option>
                  <option>36. I Sing The Mighty Power Of God</option>
                  <option>37. It Is Well With My Soul</option>
                  <option>38. Jesus Christ Is Risen Today</option>
                  <option>39. Jesus Loves Me This I Know</option>
                  <option>40. Joyful Joyful We Adore You</option>
                  <option>41. Just A Closer Walk With Thee</option>
                  <option>42. My Hope Is Built On Nothing Less</option>
                  <option>43. Nearer My God To Thee</option>
                  <option>44. Nothing But The Blood Of Jesus</option>
                  <option>45. O God Our Help In Ages Past</option>
                  <option>46. Pass Me Not Oh Gentle Savior</option>
                  <option>47. The Churchs One Foundation</option>
                  <option>48. What A Friend We Have In Jesus</option>
                  <option>49. What Wondrous Love Is This</option>
                </optgroup>
              </select>
            </div>
            <div class="item">
              <label for="song_control_select_node">Choose node or group</label>
              <select
                id="song_control_select_node"
                name="song_control_select_node"
                class="select_node"
              ></select>
            </div>
            <div class="item action">
              <input id="song_control_submit" type="button" value="PLAY" />
            </div>
          </div>
        </details>
      </div>
    </div>
  </body>
</html>
