stack_memory = %w{
0x4087e018 0x40811ce4 0x00000000 0x42021556 0x00000032 0x00000000 0x00000000 0x408116b4
0x4087e018 0x40811ce4 0x00000000 0x420081be 0x0000000e 0x4081b3e4 0x4087e02c 0x4087e068
0x4087e02c 0x4087e07c 0x00000044 0x00003000 0x00000000 0x00000000 0x00000000 0x4087e040
0x00000900 0x00000078 0x00000000 0x00000001 0x4087e054 0x00000900 0x4081b2f0 0x00000000
0x00000005 0x4087e068 0x00001000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000
0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000
0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000
0x40811d30 0x00000003 0x40811b6c 0x00000004 0x4081ad68 0x00000080 0x42121c08 0x00000005
0x00000004 0x42121c04 0x4081ad90 0x4200aab2 0x4081ad68 0x4081a53c 0x42121644 0x40811000
0x40811a70 0x4081ad90 0x4087e1d0 0x4201153c 0x408186e0 0x0000000c 0x4081965c 0x40811ac8
0x408186e0 0x0000000c 0x4081965c 0x40808892 0x00000000 0x00000000 0x00000000 0x00000000
0x06000001 0x00001800 0x0000000c 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000
0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000
0x00000000 0x00000000 0x00000000 0x00000000 0x0000004d 0x4214c2e4 0x00000006 0x00000000
0x00000000 0x00000000 0x00000000 0x0008c3d4 0x000b8688 0x000a0020 0x40800df0 0x420c0020
0x0000004d 0x4214c2e4 0x4214c2e4 0x4201556e 0x0000004d 0x0000000c 0x00300000 0x4080101a
0x00010020 0x42000020 0xffff0000 0x00700000 0x00010020 0x42000020 0xffff0000 0x4086f608
0x00000000 0x4087e3a0 0x4087e230 0x00010000 0x00000000 0x000c0000 0x00010020 0x000a0020
0x420c0020 0x42000020 0x0008c3d4 0x000b8688 0x00000000 0x00000000 0x00000000 0x40880000
0x000030d8 0x4004b05c 0x0000ffff 0xffffffff 0x00000000 0x4087e3a0 0x00000000 0x4086f894
0x4080d6f0 0x00010000 0x00200000 0x00010000 0x200206e9 0x40800df0 0x000000ee 0x0000000d
0x00ffff00 0x01000000 0x420c0020 0x0008c3d4 0x40800000 0x00003c1c 0x42000020 0x000b8688
0x40803c1c 0x0000a620 0x4080e240 0x00003104 0x50002000 0x00000010 0x00000000 0x00000000
0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000
0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000
0x00000000 0x00000000 0x00010020 0x0009c3fc 0x000a0020 0x001586b0 0x00162cd8 0x00165de4
0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000
0x00000000 0x00000000 0x00155e20 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000
0x00000000 0x00000000 0x00000000 0x00000000 0x000030d8 0x4004b05c 0x0000ffff 0x40880000
}

firmware_elf_path = "./.pio/build/seeed_xiao_esp32_c6/firmware.elf"

address_to_line_path = "#{Dir.home}/.platformio/packages/toolchain-riscv32-esp/bin/riscv32-esp-elf-addr2line"

io = IO.popen("#{address_to_line_path} -fe #{firmware_elf_path} #{stack_memory.join(" ")}")

output = io.read

output.each_line do |line|
  line = line.strip

  # Discard known lines
  next if line == "??"
  next if line == "??:0"

  puts line
end
puts
