stack_memory = %w{
0x4081f994 0x4085d0dc 0x408647fc 0x42011208 0x4212187c 0x0000001b 0x4086e630 0x00000045
0x42140000 0x00021000 0x4087e01c 0x4213a000 0x4213a000 0x4081f000 0x4086e1c0 0x42024606
0x00000000 0x00000000 0x4086e630 0x4086476c 0x00000000 0x00000000 0x00000000 0x40862c6c
0x00000008 0x40862ccc 0x00000008 0x40862d2c 0x00000008 0x40862d8c 0x00000008 0x40862dec
0x00000008 0x40862e4c 0x00000008 0x40862eac 0x00000008 0x40862f0c 0x00000008 0x40862f6c
0x00000008 0x40862fcc 0x00000008 0x4086302c 0x00000008 0x4086308c 0x00000008 0x408630ec
0x00000008 0x4086314c 0x00000008 0x4086326c 0x00000008 0x4086338c 0x00000008 0x408633ec
0x00000008 0x4086344c 0x00000008 0x408634ac 0x00000008 0x4086350c 0x00000008 0x4086356c
0x00000008 0x408635cc 0x00000008 0x4086362c 0x00000008 0x4086368c 0x00000008 0x408636ec
0x00000008 0x4086374c 0x00000008 0x408637ac 0x00000008 0x4086380c 0x00000008 0x4086386c
0x00000008 0x408638cc 0x00000008 0x4086392c 0x00000008 0x4086398c 0x00000008 0x408639ec
0x00000008 0x40863a4c 0x00000008 0x40863aac 0x00000008 0x40863b0c 0x00000008 0x40863b6c
0x00000008 0x40863bcc 0x00000008 0x40863c2c 0x00000008 0x40863c8c 0x00000008 0x40863cec
0x00000008 0x40863d4c 0x00000008 0x40863dac 0x00000008 0x40863e0c 0x00000008 0x40863e6c
0x00000008 0x40863ecc 0x00000008 0x40863f2c 0x00000008 0x40863f8c 0x00000008 0x40863fec
0x00000008 0x4086404c 0x00000008 0x4086410c 0x00000008 0x408641cc 0x00000008 0x4086422c
0x00000008 0x4086428c 0x00000008 0x408642ec 0x00000008 0x4086434c 0x00000008 0x408643ac
0x00000008 0x4086440c 0x00000008 0x4086446c 0x00000008 0x408644cc 0x00000008 0x4086452c
0x00000008 0x4086458c 0x00000008 0x408645ec 0x00000008 0x4086464c 0x00000008 0x408646ac
0x00000008 0x4086470c 0x00000008 0x4086476c 0x00000008 0x00000000 0x00000000 0x00000000
0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000
0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000
0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000
0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000
0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000
0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000
0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000
0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000
0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000
0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000
0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000
0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000 0x00000000
}

firmware_elf_path = "./.pio/build/seeed_xiao_esp32_c6/firmware.elf"

address_to_line_path = "#{Dir.home}/.platformio/packages/toolchain-riscv32-esp/bin/riscv32-esp-elf-addr2line"

io = IO.popen("#{address_to_line_path} -fe #{firmware_elf_path} #{stack_memory.join(" ")}")

output = io.read

output.each_line do |line|
  line = line.strip

  # Discard known lines
  next if line == "??"
  next if line == "??:0"

  puts line
end
puts
